schemaVersion: 2.0.0
metadata:
  name: golang-serverless
projects:
  - name: go-function
    git:
      location: https://github.com/sbose78/go-function
      branch: master
components:
  - chePlugin:
      registryEntry:
        id: ms-vscode/go/latest
  - chePlugin:
      registryEntry:
        id: redhat/dependency-analytics/latest
  - container:
      name: maven
      image: quay.io/eclipse/che-golang-1.12:nightly  

commands:
  - exec:
      id: build 
      component: maven
      commandLine: CGO_ENABLED=0 GOOS=linux go build -mod=readonly -v -o server
      workingDir: '${PROJECTS_ROOT}/go-function'

images:
  - name: golang-app
    strategy:
      name: Kaniko
    Dockerfile: Dockerfile

workloads:
  components:
    - description: Golang App built from source deployed as a 'function'.
      imageRef: golang-app
      type:
        apiVersion: serving.knative.dev/v1
        Kind: Service
      
      
